# -*- coding: utf-8 -*-
import sys,json,gzip,re
import MeCab

parse = MeCab.Tagger("-Owakati").parse

emoji_list = [u'ğŸ˜€',u'ğŸ˜›',u'ğŸ˜¸',u'ğŸ‘·',u'ğŸ’‹',u'ğŸ˜',u'ğŸ˜œ',u'ğŸ˜¹',u'ğŸ‘¸',u'ğŸ‘…',u'ğŸ˜‚',u'ğŸ˜',u'ğŸ˜º',u'ğŸ’‚',u'ğŸ’…'
              ,u'ğŸ˜ƒ',u'ğŸ˜',u'ğŸ˜»',u'ğŸ‘¼',u'ğŸ‘‹',u'ğŸ˜„',u'ğŸ˜Ÿ',u'ğŸ˜¼',u'ğŸ…',u'ğŸ‘',u'ğŸ˜…',u'ğŸ˜ ',u'ğŸ˜½',u'ğŸ‘»',u'ğŸ‘'
              ,u'ğŸ˜†',u'ğŸ˜¡',u'ğŸ˜¾',u'ğŸ‘¹',u'ğŸ˜‡',u'ğŸ˜¢',u'ğŸ˜¿',u'ğŸ‘º',u'ğŸ‘†',u'ğŸ˜ˆ',u'ğŸ˜£',u'ğŸ™€',u'ğŸ’©',u'ğŸ‘‡',u'ğŸ‘¿'
              ,u'ğŸ˜¤',u'ğŸ‘£',u'ğŸ’€',u'ğŸ‘ˆ',u'ğŸ˜‰',u'ğŸ˜¥',u'ğŸ‘¤',u'ğŸ‘½',u'ğŸ‘‰',u'ğŸ˜Š',u'ğŸ˜¦',u'ğŸ‘¥',u'ğŸ‘¾',u'ğŸ‘Œ',u'ğŸ˜§'
              ,u'ğŸ‘¦',u'ğŸ™‡',u'ğŸ˜‹',u'ğŸ˜¨',u'ğŸ‘§',u'ğŸ’',u'ğŸ‘Š',u'ğŸ˜Œ',u'ğŸ˜©',u'ğŸ‘¨',u'ğŸ™…',u'âœŠ',u'ğŸ˜',u'ğŸ˜ª',u'ğŸ‘©'
              ,u'ğŸ™†',u'âœ‹',u'ğŸ˜',u'ğŸ˜«',u'ğŸ‘ª',u'ğŸ™‹',u'ğŸ’ª',u'ğŸ˜',u'ğŸ˜¬',u'ğŸ‘«',u'ğŸ™',u'ğŸ‘',u'ğŸ˜',u'ğŸ˜­',u'ğŸ‘¬'
              ,u'ğŸ™',u'ğŸ™',u'ğŸ˜‘',u'ğŸ˜®',u'ğŸ‘­',u'ğŸ’†',u'ğŸ˜’',u'ğŸ˜¯',u'ğŸ‘®',u'ğŸ’‡',u'ğŸ˜“',u'ğŸ˜°',u'ğŸ‘¯',u'ğŸ’‘',u'ğŸ˜”'
              ,u'ğŸ˜±',u'ğŸ‘°',u'ğŸ’',u'ğŸ˜•',u'ğŸ˜²',u'ğŸ‘±',u'ğŸ™Œ',u'ğŸ˜–',u'ğŸ˜³',u'ğŸ‘²',u'ğŸ‘',u'ğŸ˜—',u'ğŸ˜´',u'ğŸ‘³',u'ğŸ‘‚'
              ,u'ğŸ˜˜',u'ğŸ˜µ',u'ğŸ‘´',u'ğŸ‘€',u'ğŸ˜™',u'ğŸ˜¶',u'ğŸ‘µ',u'ğŸ‘ƒ',u'ğŸ˜š',u'ğŸ˜·',u'ğŸ‘¶',u'ğŸ‘„',u'ğŸŒ±',u'ğŸŒ²',u'ğŸŒ³'
              ,u'ğŸŒ´',u'ğŸŒµ',u'ğŸŒ·',u'ğŸŒ¸',u'ğŸŒ¹',u'ğŸŒº',u'ğŸŒ»',u'ğŸŒ¼',u'ğŸ’',u'ğŸŒ¾',u'ğŸŒ¿',u'ğŸ€',u'ğŸ',u'ğŸ‚',u'ğŸƒ'
              ,u'ğŸ„',u'ğŸŒ°',u'ğŸ€',u'ğŸ',u'ğŸ­',u'ğŸ¹',u'ğŸ‚',u'ğŸƒ',u'ğŸ„',u'ğŸ®',u'ğŸ…',u'ğŸ†',u'ğŸ¯',u'ğŸ‡',u'ğŸ°'
              ,u'ğŸˆ',u'ğŸ±',u'ğŸ',u'ğŸ´',u'ğŸ',u'ğŸ‘',u'ğŸ',u'ğŸ“',u'ğŸ”',u'ğŸ¤',u'ğŸ£',u'ğŸ¥',u'ğŸ¦',u'ğŸ§',u'ğŸ˜'
              ,u'ğŸª',u'ğŸ«',u'ğŸ—',u'ğŸ–',u'ğŸ·',u'ğŸ½',u'ğŸ•',u'ğŸ©',u'ğŸ¶',u'ğŸº',u'ğŸ»',u'ğŸ¨',u'ğŸ¼',u'ğŸµ',u'ğŸ™ˆ'
              ,u'ğŸ™‰',u'ğŸ™Š',u'ğŸ’',u'ğŸ‰',u'ğŸ²',u'ğŸŠ',u'ğŸ',u'ğŸ¢',u'ğŸ¸',u'ğŸ‹',u'ğŸ³',u'ğŸ¬',u'ğŸ™',u'ğŸŸ',u'ğŸ '
              ,u'ğŸ¡',u'ğŸš',u'ğŸŒ',u'ğŸ›',u'ğŸœ',u'ğŸ',u'ğŸ',u'ğŸ¾',u'âš¡ï¸',u'ğŸ”¥',u'ğŸŒ™',u'â˜€ï¸',u'â›…',u'â˜ï¸',u'ğŸ’§'
              ,u'ğŸ’¦',u'â˜”',u'ğŸ’¨',u'ğŸŒŸ',u'â­',u'ğŸŒ ',u'ğŸŒ„',u'ğŸŒ…',u'ğŸŒˆ',u'ğŸŒŠ',u'ğŸŒ‹',u'ğŸŒŒ',u'ğŸ—»',u'ğŸ—¾',u'ğŸŒ'
              ,u'ğŸŒ',u'ğŸŒ',u'ğŸŒ',u'ğŸŒ‘',u'ğŸŒ’',u'ğŸŒ“',u'ğŸŒ”',u'ğŸŒ•',u'ğŸŒ–',u'ğŸŒ—',u'ğŸŒ˜',u'ğŸŒš',u'ğŸŒ',u'ğŸŒ›',u'ğŸŒœ'
              ,u'ğŸŒ',u'ğŸ…',u'ğŸ†',u'ğŸŒ½',u'ğŸ ',u'ğŸ‡',u'ğŸˆ',u'ğŸ‰',u'ğŸŠ',u'ğŸ‹',u'ğŸŒ',u'ğŸ',u'ğŸ',u'ğŸ',u'ğŸ'
              ,u'ğŸ‘',u'ğŸ“',u'ğŸ’',u'ğŸ”',u'ğŸ•',u'ğŸ–',u'ğŸ—',u'ğŸ˜',u'ğŸ™',u'ğŸš',u'ğŸ›',u'ğŸœ',u'ğŸ',u'ğŸ',u'ğŸŸ'
              ,u'ğŸ¡',u'ğŸ¢',u'ğŸ£',u'ğŸ¤',u'ğŸ¥',u'ğŸ¦',u'ğŸ§',u'ğŸ¨',u'ğŸ©',u'ğŸª',u'ğŸ«',u'ğŸ¬',u'ğŸ­',u'ğŸ®',u'ğŸ¯'
              ,u'ğŸ°',u'ğŸ±',u'ğŸ²',u'ğŸ³',u'ğŸ´',u'ğŸµ',u'â˜•',u'ğŸ¶',u'ğŸ·',u'ğŸ¸',u'ğŸ¹',u'ğŸº',u'ğŸ»',u'ğŸ¼',u'ğŸ‚'
              ,u'ğŸƒ',u'ğŸ„',u'ğŸ‹',u'ğŸ',u'ğŸ‘',u'ğŸ†',u'ğŸ‡',u'ğŸ‰',u'ğŸŠ',u'ğŸˆ',u'ğŸ’«',u'âœ¨',u'ğŸ’¥',u'ğŸ“',u'ğŸ‘‘'
              ,u'ğŸ',u'ğŸ',u'ğŸ',u'ğŸŒ',u'ğŸ®',u'ğŸ’',u'ğŸ’”',u'ğŸ’Œ',u'ğŸ’•',u'ğŸ’',u'ğŸ’“',u'ğŸ’—',u'ğŸ’–',u'ğŸ’˜',u'ğŸ’'
              ,u'ğŸ’Ÿ',u'ğŸ’œ',u'ğŸ’›',u'ğŸ’š',u'ğŸ’™',u'ğŸƒ',u'ğŸš¶',u'ğŸ’ƒ',u'ğŸš£',u'ğŸŠ',u'ğŸ„',u'ğŸ›€',u'ğŸ‚',u'ğŸ¿',u'â›„'
              ,u'ğŸš´',u'ğŸšµ',u'ğŸ‡',u'â›º',u'ğŸ£',u'âš½',u'ğŸ€',u'ğŸˆ',u'âš¾ï¸',u'ğŸ¾',u'ğŸ‰',u'â›³',u'ğŸ†',u'ğŸ½',u'ğŸ'
              ,u'ğŸ¹',u'ğŸ¸',u'ğŸ»',u'ğŸ·',u'ğŸº',u'ğŸµ',u'ğŸ¶',u'ğŸ¼',u'ğŸ§',u'ğŸ¤',u'ğŸ­',u'ğŸ«',u'ğŸ©',u'ğŸª',u'ğŸ¬'
              ,u'ğŸ¨',u'ğŸ¯',u'ğŸ±',u'ğŸ³',u'ğŸ°',u'ğŸ²',u'ğŸ®',u'ğŸ´',u'ğŸƒ',u'ğŸ€„',u'ğŸ ',u'ğŸ¡',u'ğŸ¢',u'ğŸšƒ',u'ğŸš'
              ,u'ğŸš‚',u'ğŸš‹',u'ğŸš',u'ğŸš„',u'ğŸš…',u'ğŸš†',u'ğŸš‡',u'ğŸšˆ',u'ğŸš‰',u'ğŸšŠ',u'ğŸšŒ',u'ğŸš',u'ğŸš',u'ğŸš',u'ğŸš‘'
              ,u'ğŸš’',u'ğŸš“',u'ğŸš”',u'ğŸš¨',u'ğŸš•',u'ğŸš–',u'ğŸš—',u'ğŸš˜',u'ğŸš™',u'ğŸšš',u'ğŸš›',u'ğŸšœ',u'ğŸš²',u'ğŸš',u'â›½'
              ,u'ğŸš§',u'ğŸš¦',u'ğŸš¥',u'ğŸš€',u'ğŸš',u'ğŸ’º',u'âš“',u'ğŸš¢',u'ğŸš¤',u'â›µ',u'ğŸš¡',u'ğŸš ',u'ğŸšŸ',u'ğŸ›‚',u'ğŸ›ƒ'
              ,u'ğŸ›„',u'ğŸ›…',u'ğŸ’´',u'ğŸ’¶',u'ğŸ’·',u'ğŸ’µ',u'ğŸ—½',u'ğŸ—¿',u'ğŸŒ',u'ğŸ—¼',u'â›²',u'ğŸ°',u'ğŸ¯',u'ğŸŒ‡',u'ğŸŒ†'
              ,u'ğŸŒƒ',u'ğŸŒ‰',u'ğŸ ',u'ğŸ¡',u'ğŸ¢',u'ğŸ¬',u'ğŸ­',u'ğŸ£',u'ğŸ¤',u'ğŸ¥',u'ğŸ¨',u'ğŸ©',u'ğŸ’’',u'â›ª',u'ğŸª'
              ,u'âŒš',u'ğŸ“±',u'ğŸ“²',u'ğŸ’»',u'â°',u'â³',u'âŒ›',u'ğŸ“·',u'ğŸ“¹',u'ğŸ¥',u'ğŸ“º',u'ğŸ“»',u'ğŸ“Ÿ',u'ğŸ“',u'ğŸ“ '
              ,u'ğŸ’½',u'ğŸ’¾',u'ğŸ’¿',u'ğŸ“€',u'ğŸ“¼',u'ğŸ”‹',u'ğŸ”Œ',u'ğŸ’¡',u'ğŸ”¦',u'ğŸ“¡',u'ğŸ’³',u'ğŸ’¸',u'ğŸ’°',u'ğŸ’',u'ğŸŒ‚'
              ,u'ğŸ‘',u'ğŸ‘›',u'ğŸ‘œ',u'ğŸ’¼',u'ğŸ’',u'ğŸ’„',u'ğŸ‘“',u'ğŸ‘’',u'ğŸ‘¡',u'ğŸ‘ ',u'ğŸ‘¢',u'ğŸ‘',u'ğŸ‘Ÿ',u'ğŸ‘™',u'ğŸ‘—'
              ,u'ğŸ‘˜',u'ğŸ‘š',u'ğŸ‘•',u'ğŸ‘”',u'ğŸ‘–',u'ğŸšª',u'ğŸš¿',u'ğŸ›',u'ğŸš½',u'ğŸ’ˆ',u'ğŸ’‰',u'ğŸ’Š',u'ğŸ”¬',u'ğŸ”­',u'ğŸ”®'
              ,u'ğŸ”§',u'ğŸ”ª',u'ğŸ”©',u'ğŸ”¨',u'ğŸ’£',u'ğŸš¬',u'ğŸ”«',u'ğŸ”–',u'ğŸ“°',u'ğŸ”‘',u'ğŸ“©',u'ğŸ“¨',u'ğŸ“§',u'ğŸ“¥',u'ğŸ“¤'
              ,u'ğŸ“¦',u'ğŸ“¯',u'ğŸ“®',u'ğŸ“ª',u'ğŸ“«',u'ğŸ“¬',u'ğŸ“­',u'ğŸ“„',u'ğŸ“ƒ',u'ğŸ“‘',u'ğŸ“ˆ',u'ğŸ“‰',u'ğŸ“Š',u'ğŸ“…',u'ğŸ“†'
              ,u'ğŸ”…',u'ğŸ”†',u'ğŸ“œ',u'ğŸ“‹',u'ğŸ“–',u'ğŸ““',u'ğŸ“”',u'ğŸ“’',u'ğŸ“•',u'ğŸ“—',u'ğŸ“˜',u'ğŸ“™',u'ğŸ“š',u'ğŸ“‡',u'ğŸ”—'
              ,u'ğŸ“',u'ğŸ“Œ',u'ğŸ“',u'ğŸ“',u'ğŸ“',u'ğŸš©',u'ğŸ“',u'ğŸ“‚',u'ğŸ“',u'ğŸ”',u'ğŸ”',u'ğŸ”’',u'ğŸ”“',u'ğŸ“£',u'ğŸ“¢'
              ,u'ğŸ”ˆ',u'ğŸ”‰',u'ğŸ”Š',u'ğŸ”‡',u'ğŸ’¤',u'ğŸ””',u'ğŸ”•',u'ğŸ’­',u'ğŸ’¬',u'ğŸš¸',u'ğŸ”',u'ğŸ”',u'ğŸ',u'ğŸš«',u'â›”'
              ,u'ğŸ“›',u'ğŸš·',u'ğŸš¯',u'ğŸš³',u'ğŸš±',u'ğŸ“µ',u'ğŸ”',u'ğŸ‰‘',u'ğŸ‰',u'ğŸ’®',u'ãŠ—ï¸',u'â•',u'â–',u'ã€°ï¸',u'â—'
              ,u'ğŸ”ƒ',u'ğŸ’±',u'ğŸ’²',u'â°',u'â¿',u'ã€½ï¸',u'â—',u'â“',u'â•',u'â”',u'âŒ',u'â­•',u'ğŸ’¯',u'ğŸ”š',u'ğŸ”™'
              ,u'ğŸ”›',u'ğŸ”',u'ğŸ”œ',u'ğŸŒ€',u'â“‚ï¸',u'â›',u'ğŸ”¯',u'ğŸ”°',u'ğŸ”±',u'âš ï¸',u'â™»ï¸',u'ğŸ’¢',u'ğŸ’ ',u'âšªï¸',u'âš«ï¸'
              ,u'ğŸ”˜',u'ğŸ”´',u'ğŸ”µ',u'ğŸ”º',u'ğŸ”»',u'ğŸ”¸',u'ğŸ”¹',u'ğŸ”¶',u'ğŸ”·',u'â¬›',u'â¬œ',u'â—¾',u'â—½ï¸',u'ğŸ”²',u'ğŸ”³'
              ,u'ğŸ•',u'ğŸ•œ',u'ğŸ•‘',u'ğŸ•',u'ğŸ•’',u'ğŸ•',u'ğŸ•“',u'ğŸ•Ÿ',u'ğŸ•”',u'ğŸ• ',u'ğŸ••',u'ğŸ•¡',u'ğŸ•–',u'ğŸ•¢',u'ğŸ•—'
              ,u'ğŸ•£',u'ğŸ•˜',u'ğŸ•¤',u'ğŸ•™',u'ğŸ•¥',u'ğŸ•¦',u'ğŸ•›',u'ğŸ•§',u'ğŸˆ´',u'ğŸˆµ',u'ğŸˆ²',u'ğŸˆ¶',u'ğŸˆš',u'ğŸˆ¸',u'ğŸˆº'
              ,u'ğŸˆ¹',u'ğŸˆ³',u'ğŸˆ',u'ğŸˆ¯',u'ğŸ’¹',u'â',u'âœ…',u'ğŸ“³',u'ğŸ“´',u'ğŸ†š',u'ğŸ…°ï¸',u'ğŸ…±ï¸',u'ğŸ†',u'ğŸ†‘',u'ğŸ…¾ï¸'
              ,u'ğŸ†˜',u'ğŸ†”',u'ğŸ…¿ï¸',u'ğŸš¾',u'ğŸ†’',u'ğŸ†“',u'ğŸ†•',u'ğŸ†–',u'ğŸ†—',u'ğŸ†™',u'ğŸ§',u'â™ˆï¸',u'â™‰ï¸',u'â™Šï¸',u'â™‹ï¸'
              ,u'â™Œï¸',u'â™ï¸',u'â™ï¸',u'â™ï¸',u'â™ï¸',u'â™‘ï¸',u'â™’ï¸',u'â™“ï¸',u'ğŸš»',u'ğŸš¹',u'ğŸšº',u'ğŸš¼',u'â™¿ï¸',u'ğŸš°',u'ğŸš­'
              ,u'ğŸš®',u'ğŸ”¢',u'ğŸ”¤',u'ğŸ”¡',u'ğŸ” ',u'ğŸ“¶']

emoji_set = set(emoji_list)
# çµµæ–‡å­—æ¤œå‡ºæ­£è¦è¡¨ç¾
emoji_g = u"("+u"|".join(emoji_list)+u")"
emoji_p = re.compile(emoji_g)

# URL ã®æ­£è¦è¡¨ç¾
url_p = re.compile(u"https?:[A-z/.0-9]*")
# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æ­£è¦è¡¨ç¾
account_p = re.compile(u"@[A-z_0-9]*")
# RTã®æ­£è¦è¡¨ç¾
rt_p = re.compile(u"RT.*")
# ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã®æ­£è¦è¡¨ç¾
tag_p = re.compile(ur'[#ï¼ƒ]([\wä¸€-é¾ ã-ã‚“ã‚¡-ãƒ´ãƒ¼ï½-ï½š]+)')

count = 0

with gzip.open(sys.argv[1]) as f:
    for line in f:
        js = json.loads(line)
        tweet = js["text"]
        sentence = account_p.sub("",rt_p.sub("",tag_p.sub("",url_p.sub("",tweet))))
        temp = emoji_p.split(sentence)
        place = 0
        input_instance = []
        output_instance = []
        d = {}
        if len(temp) > 1:
            try:
                for each in temp:
                    if each in emoji_set:
                        output_instance.append((each,place))
                        if not output_instance or output_instance[-1][1] != place:
                            place += 1
                    else:
                        word_list = parse(each.encode("utf-8")).split()
                        for w in word_list:
                            input_instance.append(unicode(w))
                        place += len(word_list)
                d = {"input_instance":input_instance,"output_instance":output_instance}
#                print d
                count += 1
                js = json.dumps(d)
                print js
#                print u"å…ƒã®æ–‡    ï¼š"+u" ".join(temp)
#                print u"çµµæ–‡å­—ä»¥å¤–ï¼š"+u" ".join(input_instance)
#                print u"çµµæ–‡å­—ã€€ã€€ï¼š",
#                for e,p in output_instance:
#                    print e,p,
#                print
#                print u"="*100
            except:
                pass
            if count == 1000000:
                break
